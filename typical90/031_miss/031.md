# Grundy 数

公平ゲーム G におけるあらゆる盤面すべての集合を$X_G$とし、各盤面$x \in X$から遷移可能な盤面全体の集合を$O_G(x)$、終点の盤面全体の集合を$T_G$とする。$T_G=\{x \in X_G | O_G(X) = \phi\}$である。

このとき、各盤面$x \in X$における Grundy 数$g_B(x):X_G \rightarrow \mathbb{N}$を
$$g_G(x) := mex g_G(O_G(x)) = mex \{g_G(y) \in \mathbb{N}|y \in O_G(x)\}$$
と定義する。このように定義した Grundy 数を用いると以下のように必勝判定できる。

> 公平ゲーム G において、ゲーム開始時の盤面は$a \in X_G$であるとする。この時、先手必勝であるための必要十分条件は$g_G(a) \neq 0$である。

## 解釈?

- $g_G(a) = 0$: 後手必勝
  - 操作不能である状態
  - mex の定義より、先手必勝である盤面にしか到達できない盤面なので後手必勝
- $g_G(a) \neq 0$: 先手必勝
  - 必ず後手必勝である盤面を選択できるので先手必勝

# この問題の適用

公平ゲームが N 個あるので、各ゲームを$G_i$の盤面が$x_i$であるとすると$g_G((x_1, \dots , x_N)) = g_{G_1}(x_1) \oplus \dots \oplus g_{G_N}(x_N)$(Sprague–Grundy の定理)が成り立つ

## Sprague–Grundy の定理の解釈

- $g_G((x_1, \dots , x_N)) = 0$: 後手必勝
  - 操作不能である状況
  - mex の定義よりどの盤面を動かしても、grundy 数は違う値になってしまうので先手必勝である盤面にしか到達できないので後手必勝
- $g_G((x_1, \dots , x_N)) \neq 0$: 先手必勝
  - $g_G((x_1, \dots , x_N))$の最上位ビットが立っているゲームを一つ選んで、そのゲームの状態を$g_G((x_1, \dots , x_N))$の{0, 1}を入れ替えたゲームにすれば後手必勝の盤面に到達できるから先手必勝
    - mex の定義より、そのゲームの grundy 数より小さい盤面には遷移できる、次に遷移する盤面の grundy 数は最上位ビットが 0 になっているので小さいことが保証されてので遷移は必ずできる。

## DAG であることの確認

1 回の操作で 1 つの山について, (白石の数, 青石の数) は辞書式順序の意味で真に減少しているのでループはない。
